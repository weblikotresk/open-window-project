function convertSeconds(e){let t=new Date;return t.setTime(1e3*e),t.toISOString().slice(11,16)}function videoBack(e){let t,o=new Date,n=o.getHours();if(o=2,console.log(n),t="clear-day"==e||"rain"==e?"-winter":"",(n<=18||n<=5)&&(e+="_n"),null!=document.querySelector("#videoBG > source")){let o=document.createElement("video");o.setAttribute("autoplay",!0),o.setAttribute("muted",!0),o.setAttribute("loop",!0),o.id="videoBG",o.classList.add("no_opacity");let n=document.createElement("source");n.src=`videos/${e+t}.mp4`,n.type="video/mp4",o.appendChild(n);let i=document.createElement("source");i.src=`videos/webm/${e+t}.webm`,i.type="video/webm",o.appendChild(i),document.querySelector("#videoBG").classList.add("no_opacity"),setTimeout(()=>{document.querySelector("#videoBG").classList.remove("full_opacity"),document.querySelector("#videoBG").remove(),document.body.prepend(o),document.querySelector("#videoBG").classList.add("full_opacity"),setTimeout(()=>document.querySelector("#videoBG").classList.remove("no_opacity"),400)},400)}else{let o=document.createElement("source");o.src=`videos/${e+t}.mp4`,o.type="video/mp4";let n=document.createElement("source");n.src=`videos/webm/${e+t}.webm`,n.type="video/webm",document.querySelector("#videoBG").appendChild(o),document.querySelector("#videoBG").appendChild(n),document.querySelector("#videoBG").classList.add("full_opacity"),setTimeout(()=>document.querySelector("#videoBG").classList.remove("no_opacity"),400)}}let localization={ru:{app_temp:"Ощущается как: ",pop:"Вероятность осадков",uv:"Интенсивность УФ ",uvint:"Интенсивность УФ: ",clouds:"Облачное покрытие",wind:"Ветер",sunr:"Рассвет: ",suns:"Закат: ",pres:"Давление: ",hum:"Влажность",date:"DD.MM",curr:"Текущая погода",local:"Язык",uni:"Единицы измерения",source:"Источники",tochange:"Чтобы подвердить изменения, закройте окно настроек. Страница автоматически перезагрузится.",loading:"Страница загружается, пожалуйста, подождите.",not_load:"Если страница долго не загружается, проверьте, включена ли геолокация на вашем устройстве и разрешено ли её использование на этом сайте.",geo_error:"Версия вашего браузера не поддерживает функцию передачи геолокации сторонним сайтам. Обновите его до последней версии и попробуйте снова.",wind_dir_h:"Направление ветра<br>(только для мобильных устройств)",wind_dir:"Эта функция включает автопозиционирование стрелки, которая показывает направление ветра относительно Северного полюса.<br> Может работать не на всех устройствах.<br> Если ваш компас работает некорректно, откалибруйте его в Google/Apple Maps.",on:"Включить",off:"Выключить",compass_error:"Ваш браузер не поддерживает данную функцию. Пожалуйста, обновите его до последней версии и попробуйте снова.",compass_f:"Сервис не смог получить информацию компаса. Обновите ваш браузер до последней версии и попробуйте снова.",Mon:"Пн,",Tue:"Вт,",Wed:"Ср,",Thu:"Чт,",Fri:"Пт,",Sat:"Сб,",Sun:"Вс,",units:{us:{temp:"°F",wind_units:"ми/ч",pres_units:" мм рт.ст."},ca:{temp:"°C",wind_units:"км/ч",pres_units:" мм рт.ст."},si:{temp:"°C",wind_units:"м/с",pres_units:" мм рт.ст."},uk2:{temp:"°C",wind_units:"ми/ч",pres_units:" мм рт.ст."}}},en:{app_temp:"Feels like: ",pop:"Precipation",uvint:"UV intensity: ",uv:"UV",clouds:"Cloud coverage",wind:"Wind",sunr:"Sunrise: ",suns:"Sunset: ",pres:"Pressure: ",hum:"Humidity",date:"MM.DD",curr:"Current mode",local:"Language",uni:"Units of measurements",source:"Sources",tochange:"Close the settings window to confirm the changes. The page will automatically reload.",geo_error:"Your browser version does not support the function of transferring geolocation to third-party sites. Please update it to the latest version and try again.",wind_dir_h:"Wind direction<br>(only for mobile devices)",wind_dir:"This function enables auto-positioning of the wind arrow relative to the North Pole.<br> May not work on every device.<br> If the compass doesn't work correctly, consider recalibrate it in the Google/Apple Maps.",on:"On",off:"Off",compass_error:"Compass heading is not available in your browser. Consider update it to the last version and try again.",compass_f:"Could not retrieve absolute orientation. Consider update your browser to the last version and try again.",Mon:"Mon,",Tue:"Tue,",Wed:"Wed,",Thu:"Thu,",Fri:"Fri,",Sat:"Sat,",Sun:"Sun,",loading:"Your page is loading, please wait.",not_load:"If page takes a long time loading, please, consider checking if your geolocation service is on and allowed for use on this site.",units:{us:{temp:"°F",wind_units:"mph",pres_units:" mb"},ca:{temp:"°C",wind_units:"km/h",pres_units:" mb"},si:{temp:"°C",wind_units:"m/s",pres_units:" mb"},uk2:{temp:"°C",wind_units:"mph",pres_units:" mb"}}}};null==localStorage.lang&&(localStorage.lang="ru",localStorage.units="si",localStorage.wind="off");let settingsInputs=[];settingsInputs[0]=document.querySelectorAll(".lang"),settingsInputs[1]=document.querySelectorAll(".units"),settingsInputs[2]=document.querySelectorAll(".wind-input");for(let e=0;e<settingsInputs[0].length;e++)localStorage.lang==settingsInputs[0][e].value&&(settingsInputs[0][e].checked=!0),settingsInputs[0][e].addEventListener("click",()=>{localStorage.lang=settingsInputs[0][e].value});for(let e=0;e<settingsInputs[1].length;e++)localStorage.units==settingsInputs[1][e].value&&(settingsInputs[1][e].checked=!0),settingsInputs[1][e].addEventListener("click",()=>{localStorage.units=settingsInputs[1][e].value});for(let e=0;e<settingsInputs[2].length;e++)localStorage.wind==settingsInputs[2][e].value&&(settingsInputs[2][e].checked=!0),settingsInputs[2][e].addEventListener("click",()=>{localStorage.wind=settingsInputs[2][e].value});let settingsIcon=document.querySelector("#settings > svg"),closeBtn=document.getElementsByClassName("close_settings")[0];settingsIcon.addEventListener("click",()=>{document.getElementsByClassName("settings_window")[0].style.zIndex=2,document.getElementsByClassName("settings_window")[0].style.clipPath="circle(100%)"}),closeBtn.addEventListener("click",()=>{document.getElementsByClassName("settings_window")[0].style.clipPath="circle(0.1% at 53.6% 2.2%)",setTimeout(()=>(document.getElementsByClassName("settings_window")[0].style.zIndex=-2,location.reload(),!1),550)});let load_text=document.getElementsByClassName("loading_support");function load(e=localStorage){"geolocation"in navigator?navigator.geolocation.getCurrentPosition(async t=>{localStorage!=e&&(e=localStorage);let o=t.coords.latitude,n=t.coords.longitude,i=e.lang,a=e.units,l=e.wind;console.log(o,n,a,i,localStorage,e,l);const r=`weather/${o},${n}/${i}/${a}`,s=await fetch(r,{method:"GET",withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}}),c=await s.json();function d(e){var t;"currently"==u?(e.absolute?t=e.alpha:e.hasOwnProperty("webkitCompassHeading")?t=360-e.webkitCompassHeading:(console.log("Could not retrieve absolute orientation"),t=c[u].windBearing+45),console.log(t,u),t=t+45-c[u].windBearing,document.querySelector(".wind_dir").style.transform=`rotate(${t}deg)`):(t=e.absolute?360-e.alpha:e.hasOwnProperty("webkitCompassHeading")?360-e.webkitCompassHeading:u.windBearing+45,console.log(t,u),t=t+45-u.windBearing,document.querySelector(".wind_dir").style.transform=`rotate(${t}deg)`)}console.log(c);let u="currently";function m(e,t){u=e,u="currently"!=u?c[u].data[t]:c[u],console.log(u,e,c[u]),"ondeviceorientationabsolute"in window&&"on"==localStorage.wind?window.addEventListener("deviceorientationabsolute",d):"ondeviceorientation"in window&&"on"==localStorage.wind?window.addEventListener("deviceorientation",d):"off"==localStorage.wind?(window.removeEventListener("deviceorientationabsolute",d),window.removeEventListener("deviceorientation",d),setTimeout(()=>document.querySelector(".wind_dir").style.transform=`rotate(${u.windBearing+45}deg)`,1e3)):(alert(localization[i].compass_error),document.querySelector(".wind_dir").style.transform=`rotate(${u.windBearing+45}deg)`)}function p(e,t){switch(e){case"wind":g("windSpeed","rgb(0,204,255)","rgba(0,204,255, 0.25)",localization[i].units[a].wind_units,t);break;case"humidity":g("humidity","rgb(0,238,255)","rgba(0,238,255, 0.25)","%",t);break;case"uv":g("uvIndex","rgb(163,78,233)","rgba(163,78,233, 0.25)","",t);break;case"clouds":g("cloudCover","rgb(104,231,142)","rgba(104,231,142, 0.25)","%",t);break;case"precipProbability":g("precipProbability","rgb(0, 119, 255)","rgba(0, 119, 255, 0.25)","%",t)}}function y(e){let t=document.getElementsByClassName("slide-toggle");t[0].checked=!0,function(){let e=document.getElementById("slidemenu"),t=e.cloneNode(!0);e.remove(),document.getElementById("display").appendChild(t)}();for(let o=0;o<t.length;o++)t[o].addEventListener("click",()=>{p(t[o].value,e)})}function g(e,t,o,n,l){document.getElementById("myChart").remove();let r=document.createElement("canvas");r.id="myChart",document.getElementsByClassName("chart-container")[0].append(r),console.log("chart was created");let s=[],d=0,u=[];if(""==l||0==l)for(let t=0;t<24;t++)s[t]="cloudCover"==e||"humidity"==e||"precipProbability"==e?Math.round(100*c.hourly.data[t][e]):Math.round(c.hourly.data[t][e]),document.querySelectorAll(".hour > .pop")[t].innerHTML=Math.round(100*c.hourly.data[t].precipProbability)+"%",document.querySelectorAll(".hour > .temp")[t].innerHTML=Math.round(c.hourly.data[t].temperature)+localization[i].units[a].temp,document.querySelectorAll(".hour > .sky")[t].src=`img/icons/${c.hourly.data[t].icon}.svg`,document.querySelectorAll(".hour > .time")[t].innerHTML=convertSeconds(c.hourly.data[t].time+3600*c.offset),u[t]=convertSeconds(c.hourly.data[t].time+3600*c.offset),d<s[t]&&(d=s[t]);else if(""!=l)for(let t=0;t<c.hourly.data.length;t++)if(c.hourly.data[t].time==c.daily.data[l].time)for(let o=0;o<24;o++)document.querySelectorAll(".hour > .pop")[o].innerHTML=Math.round(100*c.hourly.data[t+o].precipProbability)+"%",document.querySelectorAll(".hour > .temp")[o].innerHTML=Math.round(c.hourly.data[t+o].temperature)+localization[i].units[a].temp,document.querySelectorAll(".hour > .sky")[o].src=`img/icons/${c.hourly.data[t+o].icon}.svg`,document.querySelectorAll(".hour > .time")[o].innerHTML=convertSeconds(c.hourly.data[t+o].time+3600*c.offset),s[o]="cloudCover"==e||"humidity"==e||"precipProbability"==e?Math.round(100*c.hourly.data[t+o][e]):Math.round(c.hourly.data[t+o][e]),u[o]=convertSeconds(c.hourly.data[t+o].time+3600*c.offset),d<s[o]&&(d=s[o]);let m=0;d>70?m=30:(m=3,tooltip_pos="bottom");let p=document.getElementById("myChart").getContext("2d");new Chart(p,{type:"line",data:{labels:u,datasets:[{label:"",pointBackgroundColor:t,backgroundColor:o,borderColor:t,data:s}]},options:{maintainAspectRatio:!1,onAnimationComplete:function(){myBarChart.showTooltip(bars,!1)},scales:{xAxes:[{gridLines:{color:"rgba(255, 255, 255, 0.25)",zeroLineColor:"rgba(255, 255, 255, 0.25)",drawBorder:!1},ticks:{fontColor:"#fff",fontSize:18}}],yAxes:[{display:!1,gridLines:{color:"rgba(255, 255, 255, 0)",zeroLineColor:"rgba(255, 255, 255, 0.25)"},ticks:{beginAtZero:!0,max:d+m}}]},legend:{display:!1},showAllTooltips:!0,tooltips:{backgroundColor:"rgba(255, 255, 255, 0)",displayColors:!1,bodyFontSize:18,bodyAlign:"center",xPadding:-20,bodyFontFamily:"'Rubik', sans-serif",callbacks:{label:function(e,t){return e.yLabel+n},title:function(){return null}}}}})}Chart.pluginService.register({beforeRender:function(e){e.config.options.showAllTooltips&&(e.pluginTooltips=[],e.config.data.datasets.forEach((function(t,o){e.getDatasetMeta(o).data.forEach((function(t,o){e.pluginTooltips.push(new Chart.Tooltip({_chart:e.chart,_chartInstance:e,_data:e.data,_options:e.options.tooltips,_active:[t]},e))}))})),e.options.tooltips.enabled=!1)},afterDraw:function(e,t){if(e.config.options.showAllTooltips){if(!e.allTooltipsOnce){if(1!==t)return;e.allTooltipsOnce=!0}e.options.tooltips.enabled=!0,Chart.helpers.each(e.pluginTooltips,(function(e){e.initialize(),e.update(),e.pivot(),e.transition(t).draw()})),e.options.tooltips.enabled=!1}}});let h=document.querySelectorAll(".wind-subitem_label > h3");h[0].innerHTML=localization[i].local,h[1].innerHTML=localization[i].uni,h[2].innerHTML=localization[i].wind_dir_h,h[3].innerHTML=localization[i].source,document.querySelector(".settings_block > span").innerHTML=localization[i].tochange,document.querySelector(".wind-settings  p").innerHTML=localization[i].wind_dir;let w=document.querySelectorAll(".turn_wind");w[0].innerHTML=localization[i].on,w[1].innerHTML=localization[i].off,2020==moment().format("YYYY")?document.querySelector("#legal > p>span").innerHTML=moment().format("YYYY"):document.querySelector("#legal > p> span").innerHTML="2020-"+moment().format("YYYY");let v=function(){videoBack(c.currently.icon);let e=document.createElement("img");e.src=`img/icons/${c.currently.icon}.svg`,e.alt="",e.className="icon";let t=document.createElement("img");t.src="img/icons/water.svg",t.classList.add("pop_drop"),console.log(localization[i].units[a],i),document.querySelector(".temp_val").innerHTML=Math.round(c.currently.temperature)+localization[i].units[a].temp,document.querySelector(".app_temp").innerHTML=localization[i].app_temp+""+Math.round(c.currently.apparentTemperature)+localization[i].units[a].temp,document.querySelector(".condition").innerHTML=c.currently.summary,document.querySelector(".condition").prepend(e),document.querySelector(".propability").innerHTML=localization[i].pop+": "+Math.round(100*c.hourly.data[0].precipProbability)+"%",document.querySelector(".uv").innerHTML=localization[i].uvint+c.currently.uvIndex,document.querySelector(".clouds").innerHTML=localization[i].clouds+": "+Math.round(100*c.currently.cloudCover)+"%",document.querySelector(".wind_text > h3").innerHTML=localization[i].wind+": ",document.querySelector(".wind_speed").innerHTML=c.currently.windSpeed+" "+localization[i].units[a].wind_units,m("currently"),document.querySelector("#sunr").innerHTML=localization[i].sunr+convertSeconds(c.daily.data[0].sunriseTime+3600*c.offset),document.querySelector("#suns").innerHTML=localization[i].suns+convertSeconds(c.daily.data[0].sunsetTime+3600*c.offset),document.querySelector("#pres").innerHTML=localization[i].pres+c.currently.pressure+localization[i].units[a].pres_units,document.querySelector("#hum").innerHTML=localization[i].hum+": "+Math.round(100*c.currently.humidity)+"%";let o=document.querySelectorAll("#slidemenu > label > span");o[0].innerHTML=localization[i].wind,o[1].innerHTML=localization[i].hum,o[2].innerHTML=localization[i].uv,o[3].innerHTML=localization[i].clouds,o[4].innerHTML=localization[i].pop,null!=document.getElementsByClassName("backto")[0]&&document.getElementsByClassName("backto")[0].remove();for(let e=0;e<24;e++){let o=document.querySelectorAll(".hour > .pop")[e];o.innerHTML=t+Math.round(100*c.hourly.data[e].precipProbability)+"%",o.prepend(t),document.querySelectorAll(".hour > .temp")[e].innerHTML=Math.round(c.hourly.data[e].temperature)+localization[i].units[a].temp,document.querySelectorAll(".hour > .sky")[e].src=`img/icons/${c.hourly.data[e].icon}.svg`,document.querySelectorAll(".hour > .time")[e].innerHTML=convertSeconds(c.hourly.data[e].time+3600*c.offset)}y(""),g("windSpeed","rgb(0,204,255)","rgba(0,204,255, 0.25)",localization[i].units[a].wind_units,0),document.getElementById("days-fake").checked=!0};null!=load_text[0]&&document.getElementsByClassName("loading")[0].remove(),v();for(let e=0;e<8;e++){document.querySelectorAll(".day > .pop")[e].innerHTML=Math.round(100*c.daily.data[e].precipProbability)+"%",document.querySelectorAll(".day > .sky")[e].src=`img/icons/${c.daily.data[e].icon}.svg`,document.querySelectorAll(".day > .temp")[e].innerHTML=Math.round(c.daily.data[e].temperatureMax)+localization[i].units[a].temp;let t=moment(1e3*c.daily.data[e].time);null!=document.getElementsByClassName("weekday")[e]&&document.getElementsByClassName("weekday")[e].remove(),document.querySelectorAll(".day > .date")[e].innerHTML=localization[i][t.format("ddd")]+" "+t.format(localization[i].date)}let b=document.getElementsByClassName("day");function S(){let e=document.createElement("div");e.className="backto",e.innerHTML=localization[i].curr,e.onclick=v,window.matchMedia("(max-width: 500px)").matches?document.getElementsByClassName("day")[0].before(e):document.getElementsByClassName("app_temp")[0].after(e)}for(let e=0;e<b.length-1;e++)b[e].addEventListener("click",()=>{videoBack(c.daily.data[e].icon),document.getElementById("slide-item-1").checked="checked";let t=document.createElement("img");t.src=`img/icons/${c.daily.data[e].icon}.svg`,t.alt="",t.className="icon",document.querySelector(".temp_val").innerHTML=Math.round(c.daily.data[e].temperatureMax)+localization[i].units[a].temp,document.querySelector(".app_temp").innerHTML=localization[i].app_temp+" "+Math.round(c.daily.data[e].apparentTemperatureMax)+localization[i].units[a].temp,document.querySelector(".condition").innerHTML=c.daily.data[e].summary,document.querySelector(".condition").prepend(t),null==document.getElementsByClassName("backto")[0]||document.getElementsByClassName("backto")[0].remove(),S(),window.onresize=()=>{null!=document.getElementsByClassName("backto")[0]&&(document.getElementsByClassName("backto")[0].remove(),S())},document.querySelector(".propability").innerHTML=localization[i].pop+": "+Math.round(100*c.daily.data[e].precipProbability)+"%",document.querySelector(".uv").innerHTML=localization[i].uvint+c.daily.data[e].uvIndex,document.querySelector(".clouds").innerHTML=localization[i].clouds+": "+Math.round(100*c.daily.data[e].cloudCover)+"%",document.querySelector(".wind_text > h3").innerHTML=localization[i].wind+": ",document.querySelector(".wind_speed").innerHTML=c.daily.data[e].windSpeed+" "+localization[i].units[a].wind_units,m("daily",e),document.querySelector("#sunr").innerHTML=localization[i].sunr+convertSeconds(c.daily.data[e].sunriseTime+3600*c.offset),document.querySelector("#suns").innerHTML=localization[i].suns+convertSeconds(c.daily.data[e].sunsetTime+3600*c.offset),document.querySelector("#pres").innerHTML=localization[i].pres+c.daily.data[e].pressure+localization[i].units[a].pres_units,document.querySelector("#hum").innerHTML=localization[i].hum+": "+Math.round(100*c.daily.data[e].humidity)+"%",y(e),g("windSpeed","rgb(0,204,255)","rgba(0,204,255, 0.25)",localization[i].units[a].wind_units,e)})}):(load_text[0].innerHTML=localization.ru.geo_error,load_text[1].innerHTML=localization.en.geo_error)}load_text[0].innerHTML=localization.ru.loading,load_text[1].innerHTML=localization.en.loading,setTimeout(()=>{null!=load_text[0]&&(load_text[0].innerHTML=localization.ru.not_load,load_text[1].innerHTML=localization.en.not_load)},5e3),window.onload=load(),document.getElementById("location").onclick=load;